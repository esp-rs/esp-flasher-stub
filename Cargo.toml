[package]
name = "flasher-stub"
version = "0.1.0"
edition = "2021"
rust-version = "1.60"
license = "MIT OR Apache-2.0"
categories = ["embedded", "no-std"]
exclude = [".github/", "esptool.patch"]

[dependencies]
critical-section  = "1.1.1"
esp32-hal = { version = "0.15.0", optional = true }
esp32c2-hal = { version = "0.10.0", optional = true }
esp32c3-hal = { version = "0.12.0", optional = true }
esp32c6-hal = { version = "0.5.0", optional = true }
esp32h2-hal = { version = "0.3.0", optional = true }
esp32s2-hal = { version = "0.12.0", optional = true }
esp32s3-hal = { version = "0.12.0", optional = true }
heapless = { version = "0.7.16", default-features = false }
static_cell = "1"


[dev-dependencies]
assert2 = "0.3.7"
matches = "0.1.9"
mockall = "0.11.3"
mockall_double = "0.3.0"

[patch.crates-io]
esp32-hal = { optional = true, git = "https://github.com/mabezdev/esp-hal", rev = "79549a2ab69e0ea1b4826ddf4b597d606fc72a29" }
esp-hal-common = { optional = true, git = "https://github.com/mabezdev/esp-hal", rev = "79549a2ab69e0ea1b4826ddf4b597d606fc72a29" }

[features]
esp32 = ["esp32-hal"] 
esp32s2 = ["esp32s2-hal"]
esp32s3 = ["esp32s3-hal"]
esp32c3 = ["esp32c3-hal"]
esp32c6 = ["esp32c6-hal"]
esp32h2 = ["esp32h2-hal"]
esp32c2 = ["esp32c2-hal"]
dprint = []

[profile.release]
opt-level = "s" # temporary because of https://github.com/llvm/llvm-project/issues/57988
codegen-units = 1
lto = true
panic = "abort"
debug = true

[workspace]
members = ["xtask"]
